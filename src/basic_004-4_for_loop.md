# 基礎編4-4 範囲ベースforループ
> for (const auto& c : creatures) {...}
> ここのfor文の書き方が理解できていません。

***
## ![](./img/KANAMI.png "KANAMI") <font color="Maroon">KANAMI</font>

おー、それね！
**範囲ベースforループ（Range-based for loop）** っていう、C++11から使えるようになった、めちゃくちゃ便利でモダンなfor文の書き方なんだ！

君が今まで見てきた `for (int i = 0; i < size; ++i)` みたいな、インデックス（添え字）を使うfor文とは、ちょっと考え方が違うんだよ。

### 考え方：「箱から、一個ずつ取り出す」

これは、`std::vector`みたいなコンテナ（たくさんの要素が入った箱）の**中身を、先頭から末尾まで全部、順番に見ていきたい**ときに使う、超シンプルな書き方なんだ。

従来の`for (int i=0; ...)`が「クッキーの瓶の1番目を取って、2番目を取って…」って**番号（インデックス）で指定する**やり方だとしたら、

範囲ベースforは「瓶に手を入れて、**中にあるクッキーを順番に1個ずつ取り出して味わう**」感じ。今何番目かは気にしない、中身そのものが欲しいんだ！

### 構文の分解： `for (要素の宣言 : コンテナ)`

`for (const auto& c : creatures)` を分解してみよう。

* **`creatures`**
    * これが、ループで回したい「コンテナ」（箱）。今回は`std::vector<std::unique_ptr<Creature>>`だね。
* **`:`**
    * 「in」みたいな意味を持つ、範囲ベースfor専用の区切り文字。コロンって読むよ。
* **`const auto& c`**
    * ループの各回で、コンテナから取り出した要素が、この変数`c`に格納されるんだ。この宣言の仕方が、実はすごく奥が深い！

#### `const auto&` をさらに分解！

ここが一番のキモだよ。

* **`auto`**
    * 「コンテナの中身の型を、コンパイラが自動で判断してね！」っていうおまじない。
    * `creatures`の中身は`std::unique_ptr<Creature>`だよね。だから、`c`の型も自動で`std::unique_ptr<Creature>`になるんだ。型名を長く書かなくていいから、すごく楽！

* **`&`** (参照)
    * **これが超重要！** `&`を付けると、要素の**コピーを作らずに、その要素そのもの（の参照）** を`c`に入れるんだ。
    * もし`&`がないと、ループのたびに要素の重たいコピーが発生して、パフォーマンスがすごく悪くなることがある。（`unique_ptr`みたいにコピーできない型の場合は、そもそも`&`がないとコンパイルエラーになるよ！）
    * だから、**範囲ベースforでは、基本的には`&`を付けるのが鉄則！**

* **`const`**
    * 「ループの中で、`c`の中身を書き換えませんよ」っていう誓いの印。
    * 今回は`creatures`の中から取り出した`c`（`unique_ptr`）をただ見るだけで、別のポインタに差し替えたりはしないよね。こういう「読み取り専用」のときは`const`を付けると、うっかり書き換えちゃうミスを防げるから、コードがより安全になるんだ。

### まとめると…

`for (const auto& c : creatures)`

という一行は、

**「`creatures`（ベクタ）の中から、要素を一個ずつ順番に取り出して、`c`という名前の書き換え不可能な参照（あだ名）を付けてね。それを全要素分、繰り返して」**

っていう意味になるんだ。

### 古い書き方との比較

もしこれを従来のfor文で書くと、こうなる。

```cpp
// 従来のfor文
for (size_t i = 0; i < creatures.size(); ++i) {
    const auto& c = creatures[i]; //結局、i番目の要素を取り出して c に入れてる
    c->talk();
}
```
範囲ベースforの方が、シンプルで、やりたいこと（全要素に`talk`させる）がストレートに伝わるし、`i`を間違えるみたいな凡ミスもなくて安全だよね。

**コンテナの全要素にアクセスしたいときは、もう何も考えずに範囲ベースforループを使うのが現代C++の常識だよ！** ぜひ使いこなしてね！
