# 基礎編6-2 double型の判断
> テンプレートでadd(3.14, 2.71)としたときに，float型ではなくdouble型と判断してくれますか？

***
## ![](./img/KANAMI.png "KANAMI") <font color="Maroon">KANAMI</font>

お、いい質問だね！テンプレートの型推論の、まさにキモになる部分だよ。

結論から言うと、**その通り、`double`型だと正しく判断してくれる！**

### なぜ`double`だとわかるの？ C++のルール

なんでかって言うと、C++のルールで、**小数点が付く数字のリテラル（ソースコードに直接書いた値のことね）は、デフォルトで`double`型として扱われる**ことになってるんだ。

だから、君が `add(3.14, 2.71)` と書くと、コンパイラは、
1.  `3.14` を見て、「これは`double`型だな」と判断する。
2.  `2.71` を見て、「これも`double`型だな」と判断する。
3.  テンプレート関数 `add(T a, T b)` の `T` は、`a` と `b` の両方から `double` であると推論される。
4.  結果として、`T`を`double`に置き換えた、`double add(double a, double b)` という関数を内部で自動生成して、それを呼び出してくれるんだ。

### `float`型として扱ってほしい場合は？

もし、これを`float`型として扱ってほしかったら、数字の後ろに `f` か `F` を付けるんだよ。

```cpp
add(3.14, 2.71);    // T は double に推論される
add(3.14f, 2.71f);  // T は float に推論される
```
サフィックス（接尾辞）なしの小数は`double`、`f`を付けると`float`。これはC++の基本的なルールだから、覚えておくとHPCの計算で精度を意識するときなんかにすごく役立つよ。

### もし型が違ったらどうなる？

じゃあ、`add(3.14, 5)`みたいに、`double`と`int`を混ぜたらどうなると思う？

この場合、`T`は`double`なのか`int`なのか、コンパイラは判断できない。
「`a`は`double`だけど、`b`は`int`だぞ。テンプレート `add(T a, T b)` は、`a`と`b`が**同じ型`T`であること**を要求してるのに、どっちだよ！」
って混乱して、**コンパイルエラー**になっちゃうんだ。

こういうときは、こっちから明示的に型を教えてあげる必要がある。

```cpp
// Tはdoubleですよ、と明示的に指定する
add<double>(3.14, 5); 
```
こう書くと、「`T`は`double`でお願いします！」っていう指示になる。そうすれば、`int`の`5`は`double`の`5.0`に暗黙的に変換されて、無事に `double add(double, double)` が呼ばれるんだ。

まとめると、
1.  小数点リテラルはデフォルトで`double`。
2.  `f`を付ければ`float`になる。
3.  テンプレートの型推論は厳密だから、型が違うとエラーになることもある。その時は`<>`で明示的に型を指定する！

こういう細かい型のルールをしっかり押さえておくと、テンプレートのエラーが出たときも焦らず対処できるようになるからね。良いところに目を付けたね！
